import{r as o,p as d,a as m,j as e,C as w,b as j,c as v,d as N,L as k,I as S,B as l}from"./index-dupaeSbQ.js";function U(){const[u,b]=o.useState(""),[h,i]=o.useState(!1),[a,t]=o.useState(null),[c,p]=o.useState("");o.useEffect(()=>{const r=new URLSearchParams(window.location.search),s=r.get("email"),n=r.get("id"),f=r.get("unsubscribe"),g=window.location.pathname;s&&(b(s),p(s),(f==="true"||g.includes("unsubscribe")&&n)&&x(s))},[d,m]);const x=async r=>{i(!0),t(null);try{const s=await fetch(`https://${d}.supabase.co/functions/v1/make-server-4d80a1b0/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({email:r.trim().toLowerCase()})}),n=await s.json();s.ok?t({type:"success",message:n.message||"You have been successfully unsubscribed from the newsletter."}):t({type:"error",message:n.error||"Failed to unsubscribe. Please try the manual form below."})}catch(s){console.error("Direct unsubscribe error:",s),t({type:"error",message:"Failed to automatically unsubscribe. Please use the form below."})}finally{i(!1)}},y=async r=>{if(r.preventDefault(),!!u.trim()){i(!0),t(null);try{const s=await fetch(`https://${d}.supabase.co/functions/v1/make-server-4d80a1b0/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({email:u.trim().toLowerCase()})}),n=await s.json();s.ok?t({type:"success",message:"You have been successfully unsubscribed from the newsletter. Sorry to see you go!"}):t({type:"error",message:n.error||"Failed to unsubscribe. Please try again or contact support."})}catch(s){console.error("Unsubscribe error:",s),t({type:"error",message:"Failed to unsubscribe. Please check your connection and try again."})}finally{i(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary/20 flex items-center justify-center p-6",children:e.jsxs(w,{className:"w-full max-w-md border-border/50 shadow-xl bg-card/80 backdrop-blur-sm",children:[e.jsxs(j,{className:"text-center pb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsx(v,{className:"text-2xl text-foreground",children:"Unsubscribe from Newsletter"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"We're sorry to see you go. You can unsubscribe from Herman Kwayu's newsletter below."})]}),e.jsxs(N,{children:[e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"email",className:"text-foreground font-medium",children:"Email Address"}),e.jsx(S,{id:"email",type:"email",value:u,onChange:r=>b(r.target.value),placeholder:"Enter your email address",required:!0,className:"bg-input-background border-border/50 focus:border-primary transition-colors",disabled:!!c}),c&&!a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email automatically detected from unsubscribe link. Processing..."}),c&&a?.type==="success"&&e.jsx("p",{className:"text-xs text-green-600",children:"Automatically processed from email link."})]}),a&&e.jsx("div",{className:`p-4 rounded-xl border ${a.type==="success"?"bg-green-50 text-green-800 border-green-200":"bg-red-50 text-red-800 border-red-200"}`,children:a.message}),e.jsxs("div",{className:"space-y-3",children:[!(a?.type==="success"&&c)&&e.jsx(l,{type:"submit",className:"w-full bg-destructive hover:bg-destructive/90 text-destructive-foreground",disabled:h,children:h?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Unsubscribing..."})]}):"Unsubscribe from Newsletter"}),e.jsx(l,{type:"button",variant:"outline",className:"w-full",onClick:()=>{window.history.replaceState({},document.title,"/"),window.location.reload()},children:"Return to Website"})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-border/50 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Before you go, would you like to:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{variant:"ghost",size:"sm",className:"w-full text-primary hover:bg-primary/10",onClick:()=>window.open("https://www.linkedin.com/in/herman-kwayu-044733135","_blank"),children:"Connect on LinkedIn instead"}),e.jsx(l,{variant:"ghost",size:"sm",className:"w-full text-primary hover:bg-primary/10",onClick:()=>{window.history.replaceState({},document.title,"/#contact"),window.location.reload()},children:"Get in touch directly"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["If you're having trouble unsubscribing, please contact"," ",e.jsx("a",{href:"mailto:truthherman@gmail.com",className:"text-primary hover:underline",children:"truthherman@gmail.com"})]})})]})]})})}export{U as Unsubscribe};
