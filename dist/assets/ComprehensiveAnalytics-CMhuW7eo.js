import{r as u,p as m,a as h}from"./index-dupaeSbQ.js";class g{events=[];session;apiEndpoint;isEnabled=!1;hasWarnedAboutFailure=!1;constructor(){this.apiEndpoint=`https://${m}.supabase.co/functions/v1/make-server-4d80a1b0/analytics`,this.isEnabled=!0,this.session=this.initializeSession(),this.isEnabled&&this.startTracking()}initializeSession(){const e=localStorage.getItem("hk_analytics_session"),t=this.generateSessionId();if(e)try{const n=JSON.parse(e);return n.lastActivity=Date.now(),localStorage.setItem("hk_analytics_session",JSON.stringify(n)),n}catch{}const s={sessionId:t,startTime:Date.now(),lastActivity:Date.now(),pageViews:1,resumeActions:{builderVisited:!1,resumeCreated:!1,resumeDownloaded:!1},source:this.getTrafficSource(),referrer:document.referrer||"direct",device:this.detectDevice()};return localStorage.setItem("hk_analytics_session",JSON.stringify(s)),s}generateSessionId(){return"hk_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getTrafficSource(){const t=new URLSearchParams(window.location.search).get("utm_source"),s=document.referrer;return t||(s.includes("google")?"google":s.includes("linkedin")?"linkedin":s.includes("twitter")?"twitter":s.includes("facebook")?"facebook":s?"referral":"direct")}detectDevice(){const e=navigator.userAgent;let t="desktop";return/tablet|ipad|playbook|silk/i.test(e)?t="tablet":/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(e)&&(t="mobile"),{type:t,os:this.getOS(),browser:this.getBrowser()}}getOS(){const e=navigator.userAgent;return e.includes("Windows")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")?"iOS":"Unknown"}getBrowser(){const e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Unknown"}startTracking(){this.isEnabled&&(document.addEventListener("visibilitychange",()=>{document.hidden?this.track("page_hidden",{timestamp:Date.now()}):(this.track("page_visible",{timestamp:Date.now()}),this.updateSession())}),window.addEventListener("beforeunload",()=>{if(this.isEnabled&&(this.track("session_end",{sessionDuration:Date.now()-this.session.startTime,pageViews:this.session.pageViews,resumeActions:this.session.resumeActions}),this.events.length>0&&navigator.sendBeacon))try{const e=new Blob([JSON.stringify({events:this.events,session:this.session})],{type:"application/json"});navigator.sendBeacon(this.apiEndpoint,e)}catch{console.debug("Analytics: sendBeacon failed on page unload")}}),setInterval(()=>{this.events.length>0&&this.sendPendingEvents()},6e4),this.trackPageView())}updateSession(){this.session.lastActivity=Date.now(),this.session.pageViews++,localStorage.setItem("hk_analytics_session",JSON.stringify(this.session))}track(e,t={}){if(!this.isEnabled)return;const s={event:e,properties:{...t,url:window.location.href,path:window.location.pathname,sessionId:this.session.sessionId,device:this.session.device,source:this.session.source,referrer:this.session.referrer},timestamp:Date.now(),sessionId:this.session.sessionId};this.events.push(s),["resume_downloaded","contact_form_submitted","session_end"].includes(e)&&this.sendPendingEvents()}trackPageView(e){this.isEnabled&&(this.updateSession(),this.track("page_view",{page:e||window.location.pathname,title:document.title,timestamp:Date.now()}))}enableAnalytics(){console.log("ðŸ“Š Analytics are automatically enabled in production")}disableAnalytics(){console.log("ðŸ“Š Analytics cannot be disabled in production")}isAnalyticsEnabled(){return this.isEnabled}trackResumeBuilderVisit(){this.isEnabled&&(this.session.resumeActions.builderVisited?this.track("resume_builder_revisited",{timestamp:Date.now()}):(this.session.resumeActions.builderVisited=!0,localStorage.setItem("hk_analytics_session",JSON.stringify(this.session)),this.track("resume_builder_visited",{firstVisit:!0,timestamp:Date.now()})))}trackResumeTemplateSelected(e,t){this.isEnabled&&(this.session.resumeActions.templateSelected=e,localStorage.setItem("hk_analytics_session",JSON.stringify(this.session)),this.track("resume_template_selected",{templateId:e,templateName:t,timestamp:Date.now()}))}trackResumeCreated(e,t,s=!0){this.isEnabled&&(this.session.resumeActions.resumeCreated=!0,this.session.resumeActions.createdAt=Date.now(),localStorage.setItem("hk_analytics_session",JSON.stringify(this.session)),this.track("resume_created",{templateId:e,templateName:t,hasContent:s,timeFromStart:Date.now()-this.session.startTime,timestamp:Date.now()}))}trackResumeDownloaded(e,t,s="PDF"){if(!this.isEnabled)return;const n=this.session.resumeActions.resumeCreated,c=this.session.resumeActions.createdAt?Date.now()-this.session.resumeActions.createdAt:0;this.session.resumeActions.resumeDownloaded=!0,this.session.resumeActions.downloadedAt=Date.now(),localStorage.setItem("hk_analytics_session",JSON.stringify(this.session)),this.track("resume_downloaded",{templateId:e,templateName:t,format:s,wasCreated:n,timeFromCreation:c,timeFromStart:Date.now()-this.session.startTime,timestamp:Date.now()})}trackUserInteraction(e,t,s={}){this.isEnabled&&this.track("user_interaction",{element:e,action:t,...s,timestamp:Date.now()})}trackFormSubmission(e,t,s={}){this.isEnabled&&this.track("form_submission",{formType:e,success:t,...s,timestamp:Date.now()})}async sendPendingEvents(){if(!this.isEnabled||this.events.length===0){this.events=[];return}const e=[...this.events];this.events=[];try{const t=new AbortController,s=setTimeout(()=>t.abort(),5e3),n=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({events:e,session:this.session}),signal:t.signal});if(clearTimeout(s),n.ok)console.log(`ðŸ“Š Analytics: Successfully sent ${e.length} events`),this.hasWarnedAboutFailure=!1;else throw new Error(`HTTP ${n.status}: ${n.statusText}`)}catch{this.hasWarnedAboutFailure||(console.debug("ðŸ“Š Analytics: Network request failed - events will be queued for retry"),this.hasWarnedAboutFailure=!0),this.events.length<20&&this.events.unshift(...e.slice(0,5))}}getSessionData(){return{...this.session}}getConversionFunnel(){const e=this.getSessionData(),t=1,s=e.resumeActions.builderVisited?1:0,n=e.resumeActions.resumeCreated?1:0,c=e.resumeActions.resumeDownloaded?1:0;return{totalVisitors:t,resumeBuilderVisitors:s,resumeCreators:n,resumeDownloaders:c,conversionRates:{visitorToBuilder:s/t,builderToCreator:s>0?n/s:0,creatorToDownloader:n>0?c/n:0,visitorToDownloader:c/t}}}}let d=null;const r={getInstance(){return!d&&typeof window<"u"&&(d=new g),d||new f},track:(i,e={})=>r.getInstance().track(i,e),trackPageView:i=>r.getInstance().trackPageView(i),trackResumeBuilderVisit:()=>r.getInstance().trackResumeBuilderVisit(),trackResumeTemplateSelected:(i,e)=>r.getInstance().trackResumeTemplateSelected(i,e),trackResumeCreated:(i,e,t)=>r.getInstance().trackResumeCreated(i,e,t),trackResumeDownloaded:(i,e,t)=>r.getInstance().trackResumeDownloaded(i,e,t),trackUserInteraction:(i,e,t)=>r.getInstance().trackUserInteraction(i,e,t),trackFormSubmission:(i,e,t)=>r.getInstance().trackFormSubmission(i,e,t),enableAnalytics:()=>r.getInstance().enableAnalytics(),disableAnalytics:()=>r.getInstance().disableAnalytics(),isAnalyticsEnabled:()=>r.getInstance().isAnalyticsEnabled(),getSessionData:()=>r.getInstance().getSessionData(),getConversionFunnel:()=>r.getInstance().getConversionFunnel()};class f{track(){}trackPageView(){}trackResumeBuilderVisit(){}trackResumeTemplateSelected(){}trackResumeCreated(){}trackResumeDownloaded(){}trackUserInteraction(){}trackFormSubmission(){}enableAnalytics(){}disableAnalytics(){}isAnalyticsEnabled(){return!1}getSessionData(){return{sessionId:"dummy",startTime:Date.now(),lastActivity:Date.now(),pageViews:0,resumeActions:{builderVisited:!1,resumeCreated:!1,resumeDownloaded:!1},device:{type:"desktop"}}}getConversionFunnel(){return{totalVisitors:0,resumeBuilderVisitors:0,resumeCreators:0,resumeDownloaders:0,conversionRates:{visitorToBuilder:0,builderToCreator:0,creatorToDownloader:0,visitorToDownloader:0}}}}function k(){return u.useEffect(()=>{const i=r.getInstance();if(!i.isAnalyticsEnabled())return;let e=0;const t=()=>{const a=Math.round(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100);a>e&&(e=a,a>=25&&e<25?i.track("scroll_depth",{depth:"25%"}):a>=50&&e<50?i.track("scroll_depth",{depth:"50%"}):a>=75&&e<75?i.track("scroll_depth",{depth:"75%"}):a>=90&&e<90&&i.track("scroll_depth",{depth:"90%"}))},s=Date.now(),n=()=>{const a=Date.now()-s;i.track("time_on_page",{timeSpent:Math.round(a/1e3),page:window.location.pathname})};window.addEventListener("scroll",t,{passive:!0}),window.addEventListener("beforeunload",n);const c=a=>{const o=a.target;if(o.tagName==="BUTTON"||o.closest("button")){const l=o.tagName==="BUTTON"?o:o.closest("button");i.trackUserInteraction("button","click",{buttonText:l?.textContent?.trim()||"Unknown",buttonId:l?.id||"no-id",buttonClass:l?.className||"no-class"})}if(o.tagName==="A"||o.closest("a")){const l=o.tagName==="A"?o:o.closest("a");i.trackUserInteraction("link","click",{linkText:l?.textContent?.trim()||"Unknown",linkHref:l?.href||"no-href",isExternal:l?.hostname!==window.location.hostname})}};return document.addEventListener("click",c),()=>{window.removeEventListener("scroll",t),window.removeEventListener("beforeunload",n),document.removeEventListener("click",c),n()}},[]),null}export{k as ComprehensiveAnalytics,r as analytics};
